<!-- I don't know if "turtlebot_navigate" is the right name for this file -->

<launch>
<arg name="gui" default="true" />
<arg name="world_file" default="$(find turtlebot_gazebo)/worlds/playground.world"/>

<!--
<group>
<remap from="scan" to="raw_scan"/>

  <include file="$(find gazebo_ros)/launch/empty_world.launch">
      <arg name="use_sim_time" value="true"/>
      <arg name="debug" value="false"/>
      <arg name="gui" value="$(arg gui)" />
      <arg name="world_name" value="$(arg world_file)"/>
      
    </include>
    
    
</group>
-->

<group>
  <include file="$(find turtlebot_gazebo)/launch/amcl_demo.launch">
      <!--<arg name="map_file" value="$(find expected_scan_generator)/map_by_thomas.yaml"/>-->
      <!--<arg name="map_file" value="$(find expected_scan_generator)/../maps/9e_suite.yaml"/>-->
      <arg name="map_file" value="$(find expected_scan_generator)/../maps/outside_B08E.yaml"/>
    </include>

</group>
<!--
<include file="$(find turtlebot_rviz_launchers)/launch/view_navigation.launch">
    <arg 
  </include>
-->

<node name="rviz" pkg="rviz" type="rviz" args="-d $(find expected_scan_generator)/rviz/view_laserscans.rviz"/>
<param name="min_angle" value="0"/>
<param name="max_angle" value="6.28319"/>
<param name="range" value="3.5"/>
<node pkg="expected_scan_generator" type="expected_scan_generator" name="expected_scan_node">
  
</node>
<node pkg="novel_lidar_detection" type="novel_lidar_detection" name="novel_lidar_detection">
  <param name="out_scan_topic" value="scan"/>
  <param name="in_scan_topic" value="raw_scan"/>
  <param name="threshold" value="10"/>
</node>

  <param name="robot_description" command="$(find xacro)/xacro.py --inorder $(find novel_gazebo)/model/turtlebot_lidar/turtlebot_lidar.urdf.xacro"/>
  <node name="spawn_urdf" pkg="gazebo_ros" type="spawn_model" args="-param robot_description -urdf -model turtlebot_lidar" />
  <node name="robot_state_publisher_2" pkg="robot_state_publisher" type="state_publisher"/> <!-- there i go again, jankifying everything -->

<!-- Spin up the real turtlebot --> 
<include file="$(find turtlebot_bringup)/launch/minimal.launch"></include>

<!-- is this the best way to start the rplidar node? -->
<node name="rplidarNode"          pkg="rplidar_ros"  type="rplidarNode" output="screen">
  <remap from="scan" to="raw_scan"/>

  <param name="serial_port"         type="string" value="/dev/ttyUSB0"/>
  <param name="serial_baudrate"     type="int"    value="115200"/><!--A1/A2 -->
  <!--param name="serial_baudrate"     type="int"    value="256000"--><!--A3 -->
  <param name="frame_id"            type="string" value="camera_depth_frame"/>
  <param name="inverted"            type="bool"   value="false"/>
  <param name="angle_compensate"    type="bool"   value="true"/>
</node>


</launch>
